<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selectbook – Exam Test Series</title>

<style>
/* (ALL original styles preserved) */
*{box-sizing:border-box;}
body{
 margin:0;
 font-family:Arial, Helvetica, sans-serif;
 background:#f5f6fa;
 color:#1f2933;
}

/* TOP BAR */
.topbar{
 position:sticky;
 top:0;
 z-index:50;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:10px 16px;
 background:#0D47A1;
 color:#fff;
 box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
.topbar-left{
 display:flex;
 align-items:center;
 gap:10px;
}
.back-btn{
 width:30px;
 height:30px;
 border-radius:50%;
 border:none;
 background:rgba(255,255,255,0.15);
 display:flex;
 align-items:center;
 justify-content:center;
 cursor:pointer;
}
.back-btn span{
 border:solid #fff;
 border-width:0 0 2px 2px;
 display:inline-block;
 padding:3px;
 transform:rotate(45deg);
 margin-left:2px;
}
.top-title{
 font-size:15px;
 font-weight:bold;
}
.top-sub{
 font-size:11px;
 opacity:0.8;
}

/* PAGE CONTAINER */
.page{
 max-width:1100px;
 margin:0 auto;
 padding:16px;
}

/* SUMMARY BANNER */
.summary-card{
 background:linear-gradient(135deg,#0D47A1,#1976D2);
 border-radius:14px;
 padding:16px 16px 14px;
 color:#fff;
 margin-bottom:14px;
 box-shadow:0 6px 16px rgba(13,71,161,0.35);
}
.summary-row{
 display:flex;
 flex-wrap:wrap;
 gap:14px;
 align-items:flex-start;
}
.summary-left{
 flex:1;
 min-width:220px;
}
.summary-left h1{
 margin:0 0 6px;
 font-size:20px;
}
.summary-left p{
 margin:0;
 font-size:13px;
}
.tag-strip{
 margin-top:10px;
 display:flex;
 flex-wrap:wrap;
 gap:6px;
}
.tag{
 font-size:11px;
 padding:4px 8px;
 border-radius:999px;
 background:rgba(255,255,255,0.15);
 border:1px solid rgba(255,255,255,0.3);
}
.summary-right{
 min-width:200px;
 text-align:right;
}
.summary-pills{
 display:flex;
 flex-direction:column;
 gap:4px;
 align-items:flex-end;
}
.summary-pill{
 font-size:11px;
 padding:4px 10px;
 border-radius:999px;
 background:rgba(255,255,255,0.1);
 border:1px solid rgba(255,255,255,0.35);
}
.exam-level{
 margin-top:6px;
 font-size:12px;
 font-weight:bold;
}

/* CBT TABS */
.cbt-tabs{
 margin-top:14px;
 display:flex;
 gap:8px;
 flex-wrap:wrap;
}
.cbt-tab-btn{
 flex:1;
 min-width:120px;
 padding:10px 10px;
 border-radius:999px;
 border:1px solid #0D47A1;
 background:#ffffff;
 color:#0D47A1;
 font-size:13px;
 font-weight:bold;
 cursor:pointer;
 display:flex;
 align-items:center;
 justify-content:center;
 gap:6px;
}
.cbt-tab-btn span.badge{
 font-size:10px;
 padding:2px 6px;
 border-radius:999px;
 background:#E3F2FD;
 color:#0D47A1;
}
.cbt-tab-btn.active{
 background:#0D47A1;
 color:#ffffff;
}
.cbt-tab-btn.active span.badge{
 background:#FFECB3;
 color:#5d3c00;
}

/* CBT INFO STRIP */
.cbt-info{
 margin-top:10px;
 padding:10px 12px;
 border-radius:10px;
 background:#E3F2FD;
 border:1px solid #BBDEFB;
 font-size:12px;
 display:flex;
 flex-wrap:wrap;
 gap:8px;
 align-items:center;
}
.cbt-info strong{
 color:#0D47A1;
}
.cbt-info span.chip{
 padding:3px 8px;
 border-radius:999px;
 background:#ffffff;
 border:1px solid #BBDEFB;
 font-size:11px;
}

/* HORIZONTAL MENU (Full / Sectional / Pyq / Topic) — scrollable like your sketch */
.hmenu{
 margin-top:12px;
 display:flex;
 gap:8px;
 overflow-x:auto;
 padding:8px 6px;
}
.hmenu button{
 min-width:180px;
 padding:10px 12px;
 border-radius:8px;
 border:1px solid #d7eafc;
 background:#fff;
 color:#0d47a1;
 font-weight:800;
 cursor:pointer;
 flex-shrink:0;
}
.hmenu button.active{
 background:#0d47a1;
 color:#fff;
}

/* MOCK LIST */
.section-heading{
 margin:16px 0 8px;
 font-size:15px;
 font-weight:bold;
 color:#0d47a1;
}
.mock-grid{
 display:flex;
 flex-direction:column;
 gap:10px;
}

/* MOCK CARD */
.mock-card{
 background:#ffffff;
 border-radius:10px;
 padding:10px 12px;
 border:1px solid #dde4f0;
 box-shadow:0 1px 4px rgba(0,0,0,0.04);
 display:flex;
 flex-direction:column;
 gap:6px;
}
.mock-header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 gap:8px;
}
.mock-title{
 font-size:14px;
 font-weight:bold;
}
.mock-label{
 font-size:11px;
 padding:3px 8px;
 border-radius:999px;
 background:#FFF8E1;
 color:#8D6E00;
}
.mock-meta{
 font-size:12px;
 color:#4b5563;
 display:flex;
 flex-wrap:wrap;
 gap:10px;
}
.mock-meta span{
 display:flex;
 align-items:center;
 gap:4px;
}
.dot{
 width:6px;
 height:6px;
 border-radius:50%;
 background:#0D47A1;
}
.mock-footer{
 display:flex;
 justify-content:space-between;
 align-items:center;
 gap:10px;
 margin-top:2px;
}
.mock-tags{
 display:flex;
 gap:6px;
 flex-wrap:wrap;
 font-size:11px;
}
.mock-tag{
 padding:3px 7px;
 border-radius:999px;
 background:#f1f5f9;
 border:1px solid #e2e8f0;
}
.mock-btn{
 padding:7px 14px;
 border-radius:999px;
 border:none;
 background:#0D47A1;
 color:#ffffff;
 font-size:12px;
 font-weight:bold;
 cursor:pointer;
}
.mock-btn.secondary{
 background:#ffffff;
 color:#0D47A1;
 border:1px solid #0D47A1;
}

/* CBT PANELS */
.cbt-panel{
 display:none;
 margin-top:4px;
}
.cbt-panel.active{
 display:block;
}

/* RESPONSIVE */
@media (max-width:600px){
 .summary-right{
  text-align:left;
 }
 .summary-pills{
  align-items:flex-start;
 }
 .mock-footer{
  flex-direction:column;
  align-items:flex-start;
 }
 .mock-btn{
  width:100%;
  text-align:center;
 }
}
</style>
</head>
<body>

<!-- TOP BAR -->
<header class="topbar">
  <div class="topbar-left">
    <button class="back-btn" type="button" onclick="window.location.href='index.html#tests'">
      <span></span>
    </button>
    <div>
<div class="top-title" id="pageTitle"></div>
<div class="top-sub" id="pageSub"></div> Test Series</div>
    </div>
  </div>
</header>

<main class="page">

  <!-- SUMMARY BANNER -->
  <section class="summary-card">
    <div class="summary-row">
      <div class="summary-left">
<h1 id="summaryTitle"></h1>
<p id="summaryDesc"></p>
<div class="tag-strip" id="summaryTags"></div>
<div class="summary-pills" id="summaryPills"></div>
        </div>
        <div class="exam-level" id="examCount">Total: 20+ Full Tests Planned</div>
      </div>
    </div>

    <!-- CBT TABS -->
    <div class="cbt-tabs" id="cbtTabs">
      <button class="cbt-tab-btn active" data-target="cbt1">
        CBT-1 Full Tests
        <span class="badge">Foundation</span>
      </button>
      <button class="cbt-tab-btn" data-target="cbt2" id="cbt2Btn">
        CBT-2 Full Tests
        <span class="badge">Technical</span>
      </button>
    </div>
  </section>

  <!-- Horizontal menu like your sketch (Full / Sectional /  / Topic) -->
  <div class="hmenu" id="hmenu">
    <!-- buttons inserted dynamically to reflect exam's available modes -->
  </div>

  <!-- CBT-1 PANEL -->
  <section class="cbt-panel active" id="cbt1">
    <div class="cbt-info" id="cbt1Info">
      <strong id="cbt1Title">CBT-1 Pattern:</strong>
      <span class="chip" id="cbt1Q">75 Questions</span>
      <span class="chip" id="cbt1T">60 Minutes</span>
      <span class="chip" id="cbt1Subjects">Maths • Reasoning • Science • GK</span>
      <span class="chip" id="cbt1Neg">Negative Marking लागू</span>
    </div>

    <h2 class="section-heading" id="panel-title">CBT-1 Full Length Mock Tests</h2>

    <div class="mock-grid" id="mock-list">
      <!-- demo cards will be inserted by JS -->
    </div>
  </section>

  <!-- CBT-2 PANEL -->
  <section class="cbt-panel" id="cbt2">
    <div class="cbt-info" id="cbt2Info">
      <strong id="cbt2Title">CBT-2 Pattern:</strong>
      <span class="chip" id="cbt2A">Part-A: Technical Subjects</span>
      <span class="chip" id="cbt2B">Part-B: Maths, Reasoning, GK</span>
      <span class="chip" id="cbt2C">Higher Difficulty</span>
      <span class="chip" id="cbt2D">Post Specific Syllabus</span>
    </div>

    <h2 class="section-heading" id="panel-title-2">CBT-2 Full Length Mock Tests</h2>

    <div class="mock-grid" id="mock-list-2">
      <!-- CBT-2 demo cards inserted by JS -->
    </div>
  </section>

  <!-- NOTE -->
  <div class="note-box" style="margin-top:18px; padding:10px 12px; border-radius:10px; background:#FFFDE7; border:1px solid #FFF59D; font-size:11px; color:#795548;">
    ⚠ <strong>ध्यान दें:</strong> ऊपर दिए गए सभी Full/Sectional//Topic tests डेमो के रूप में हैं — आप इच्छानुसार हर टेस्ट को JSON ID से लिंक कर सकते हैं एवं exam-instructions.html के साथ integrate कर सकते हैं।
  </div>

</main>

<script>
/*
  Genericized template based on your provided ALP file (keeps UI identical).
  - Reads ?exam=EXAMKEY (case-insensitive) and optional ?test=TEST_ID
  - Tries to load exam-data.json (preferred). If not available (file:// preview), uses INLINE fallback.
  - Renders modes and CBT lists dynamically. Hides CBT-2 if exam has none.
  - Start Test redirects to exam-instructions.html?exam=...&test=...
*/

/* ---------- INLINE fallback data (for Acode / file:// preview) ----------
   You can expand this with more exams for testing. Keys are normalized to UPPERCASE.
*/

/* ---------- Load external exam-data.json if present ---------- */
let EXAM_DATA = null;
async function loadExamData(){
  try{
    const r = await fetch('./data/exams.json', { cache:'no-store' });
    if(!r.ok){
      throw new Error('exams.json not found');
    }

    const j = await r.json();
    const norm = {};
    Object.keys(j).forEach(k => {
      norm[String(k).toUpperCase()] = j[k];
    });

    EXAM_DATA = norm;
    resolveCurrentExam();
    console.log('Loaded data/exams.json successfully');

  } catch(err){
    console.error('Failed to load exams.json', err);
  }
}

/* ---------- Helpers ---------- */
function qp(name){ return new URLSearchParams(location.search).get(name); }
function uc(s){ return s ? String(s).toUpperCase() : s; }
function clearChildren(el){ while(el.firstChild) el.removeChild(el.firstChild); }

/* find a test by id across exams (case-insensitive). returns {examKey, cbtKey, mode, testObj} or null */
function findTestById(testId){
  if(!testId) return null;
  const tid = uc(testId);
  for(const ek of Object.keys(EXAM_DATA||{})){
    const exam = EXAM_DATA[ek];
    for(const cbtKey of ['cbt1','cbt2']){
      if(!exam[cbtKey]) continue;
      for(const mode of Object.keys(exam[cbtKey] || {})){
        const arr = exam[cbtKey][mode] || [];
        for(const t of arr){
          if(uc(t.id) === tid){
            return {examKey:ek, cbtKey, mode, testObj:t};
          }
        }
      }
    }
  }
  return null;
}

/* ---------- Render logic ---------- */
let currentExamKey = null;
async function init(){
  await loadExamData();

  const examParam = qp('exam');
  const testParam = qp('test');

  // determine current exam
  if(examParam){
    const cand = uc(examParam);
    if(EXAM_DATA[cand]) currentExamKey = cand;
  }
  if(!currentExamKey && testParam){
    const f = findTestById(testParam);
    if(f) currentExamKey = f.examKey;
  }
  if(!currentExamKey){
    // try saved
    try{
      const saved = localStorage.getItem('selectbook-exam');
      if(saved && EXAM_DATA[saved]) currentExamKey = saved;
    }catch(e){}
  }
  if(!currentExamKey){
    // fallback to first key
    currentExamKey = Object.keys(EXAM_DATA)[0];
  }
  try{ localStorage.setItem('selectbook-exam', currentExamKey); }catch(e){}

  renderSummary(currentExamKey);
  buildModeMenu(
  EXAM_DATA[currentExamKey].modes || ['full','sectional','pyq','topic']
);
  renderCBTAvailability(currentExamKey);
  renderLists(); // initial lists

  // if user opened with ?test=ID, try to highlight mode & cbt containing it
  if(testParam){
    const found = findTestById(testParam);
    if(found && found.examKey === currentExamKey){
      // switch to appropriate cbt tab
      const cbtBtn = document.querySelector(`.cbt-tab-btn[data-target="${found.cbtKey}"]`);
      if(cbtBtn) cbtBtn.click();
      // activate corresponding mode button after a short delay (menus rendered)
      setTimeout(()=> {
        const modeBtn = document.querySelector(`#hmenu button[data-mode="${found.mode}"]`);
        if(modeBtn) modeBtn.classList.add('active');
      }, 120);
    }
  }
}

/* summary banner */
function renderSummary(key){
  const ex = EXAM_DATA[key];
  document.getElementById('pageTitle').textContent = (ex.title || key) + ' – Full Test Series';
  document.getElementById('pageSub').textContent = (ex.subtitle || '') + ' • Complete Mock Test Interface';
  document.getElementById('summaryTitle').textContent = ex.title ? (ex.title + ' Complete Mock Test Planner') : 'Complete Mock Test Planner';
  document.getElementById('summaryDesc').textContent = ex.subtitle || '';
  // tags
  const tagsWrap = document.getElementById('summaryTags'); clearChildren(tagsWrap);
  (ex.tags||[]).forEach(t=>{
    const sp = document.createElement('span'); sp.className='tag'; sp.textContent = t; tagsWrap.appendChild(sp);
  });
  // pills
  const pills = document.getElementById('summaryPills'); clearChildren(pills);
  const p1 = document.createElement('span'); p1.className='summary-pill'; p1.textContent = ex.cbt1 ? 'CBT-1 available' : 'CBT-1';
  pills.appendChild(p1);
  if(ex.cbt2 && Object.keys(ex.cbt2).some(m=> (ex.cbt2[m]||[]).length>0 )){
    const p2 = document.createElement('span'); p2.className='summary-pill'; p2.textContent = 'CBT-2 available';
    pills.appendChild(p2);
  }
  // examCount
  const countFull1 = (ex.cbt1 && ex.cbt1.full) ? ex.cbt1.full.length : 0;
  const countFull2 = (ex.cbt2 && ex.cbt2.full) ? ex.cbt2.full.length : 0;
  const total = countFull1 + countFull2;
  document.getElementById('examCount').textContent = `Total: ${total} Full Tests Planned`;
}

/* build horizontal mode menu from exam's modes */
function buildModeMenu(modesArr){
  const wrap = document.getElementById('hmenu');
  clearChildren(wrap);
  // ensure preferred order
  const order = ['full','sectional','pyq','topic'];
  order.forEach(m=>{
    if((modesArr||[]).map(x=>String(x).toLowerCase()).includes(m)){
      const b = document.createElement('button');
      b.setAttribute('data-mode', m);
      b.textContent = (m.charAt(0).toUpperCase()+m.slice(1));
      b.addEventListener('click', ()=> {
        // toggle active class
        document.querySelectorAll('#hmenu button').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        renderLists();
      });
      wrap.appendChild(b);
    }
  });
  // set first as active
  const first = wrap.querySelector('button');
  if(first) first.classList.add('active');
}

/* show/hide CBT-2 button based on exam availability */
function renderCBTAvailability(key){
  const ex = EXAM_DATA[key];
  const cbt2Btn = document.getElementById('cbt2Btn');
  const hasCbt2 = ex.cbt2 && Object.keys(ex.cbt2).some(m=> (ex.cbt2[m]||[]).length>0 );
  if(!hasCbt2){
    cbt2Btn.style.display = 'none';
    // ensure cbt1 active
    document.querySelectorAll('.cbt-tab-btn').forEach(btn=>btn.classList.remove('active'));
    const c1 = document.querySelector('.cbt-tab-btn[data-target="cbt1"]'); if(c1) c1.classList.add('active');
    document.getElementById('cbt1').classList.add('active');
    document.getElementById('cbt2').classList.remove('active');
  } else {
    cbt2Btn.style.display = '';
  }
}

/* render lists for currently active CBT panel and active mode */
function renderLists(){
  const activeCbt = document.querySelector('.cbt-tab-btn.active') ? document.querySelector('.cbt-tab-btn.active').getAttribute('data-target') : 'cbt1';
  const activeModeBtn = document.querySelector('#hmenu button.active');
  const activeMode = activeModeBtn ? activeModeBtn.getAttribute('data-mode') : 'full';
  const data = EXAM_DATA[currentExamKey];

  // choose arrays
  const arr1 = (data.cbt1 && data.cbt1[activeMode]) ? data.cbt1[activeMode] : [];
  const arr2 = (data.cbt2 && data.cbt2[activeMode]) ? data.cbt2[activeMode] : [];

  // update headings
  const heading1 = document.getElementById('panel-title');
  const heading2 = document.getElementById('panel-title-2');
  const labelMap = {
  full: 'Full Length Mock Tests',
  sectional: 'Sectional Tests',
  pyq: 'Previous Year Papers',
  topic: 'Topic Wise Tests'
};
  heading1.textContent = `CBT-1 — ${labelMap[activeMode]}`;
  heading2.textContent = `CBT-2 — ${labelMap[activeMode]}`;

  // render CBT1
  const container1 = document.getElementById('mock-list'); clearChildren(container1);
  if(arr1.length===0){
    const empty = document.createElement('div'); empty.style.color='#55606a'; empty.textContent = 'इस श्रेणी में अभी कोई टेस्ट उपलब्ध नहीं है।';
    container1.appendChild(empty);
  } else {
    arr1.forEach(it=>{
      const card = document.createElement('article'); card.className='mock-card';
      card.innerHTML = `
        <div class="mock-header">
          <div class="mock-title">${it.title}</div>
          <div class="mock-label">${it.label || ''}</div>
        </div>
        <div class="mock-meta">${(it.meta||[]).map(m=>`<span><span class="dot"></span>${m}</span>`).join('')}</div>
        <div class="mock-footer">
          <div class="mock-tags">${(it.meta||[]).map(m=>`<span class="mock-tag">${m}</span>`).join('')}</div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button class="mock-btn" onclick="startTest('${it.id}')">Start Test</button>
            <button class="mock-btn secondary" onclick="previewTest('${it.id}')">Preview</button>
          </div>
        </div>`;
      container1.appendChild(card);
    });
  }

  // render CBT2
  const container2 = document.getElementById('mock-list-2'); clearChildren(container2);
  if(arr2.length===0){
    const empty = document.createElement('div'); empty.style.color='#55606a'; empty.textContent = 'इस श्रेणी में अभी कोई टेस्ट उपलब्ध नहीं है।';
    container2.appendChild(empty);
  } else {
    arr2.forEach(it=>{
      const card = document.createElement('article'); card.className='mock-card';
      card.innerHTML = `
        <div class="mock-header">
          <div class="mock-title">${it.title}</div>
          <div class="mock-label">${it.label || ''}</div>
        </div>
        <div class="mock-meta">${(it.meta||[]).map(m=>`<span><span class="dot"></span>${m}</span>`).join('')}</div>
        <div class="mock-footer">
          <div class="mock-tags">${(it.meta||[]).map(m=>`<span class="mock-tag">${m}</span>`).join('')}</div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button class="mock-btn" onclick="startTest('${it.id}')">Start Test</button>
            <button class="mock-btn secondary" onclick="previewTest('${it.id}')">Preview</button>
          </div>
        </div>`;
      container2.appendChild(card);
    });
  }
}

/* startTest: redirects to instruction page with both exam & test params */
function startTest(testId){
  // find test to get examKey if not explicit
  const found = findTestById(testId);
  const examToSend = found ? found.examKey : currentExamKey;
  // persist selected test
  try{ localStorage.setItem('selectbook-selectedTestId', testId); }catch(e){}
  window.location.href = `exam-instructions.html?exam=${encodeURIComponent(examToSend)}&test=${encodeURIComponent(testId)}`;
}
function previewTest(testId){
  alert('Preview: ' + testId);
}

/* CBT tab click behaviour (reuse existing buttons) */
document.querySelectorAll('.cbt-tab-btn').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    document.querySelectorAll('.cbt-tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const target = btn.getAttribute('data-target');
    document.getElementById('cbt1').classList.toggle('active', target==='cbt1');
    document.getElementById('cbt2').classList.toggle('active', target==='cbt2');
    // reset mode to full on tab switch
    const firstMode = document.querySelector('#hmenu button');
    if(firstMode){
      document.querySelectorAll('#hmenu button').forEach(x=>x.classList.remove('active'));
      firstMode.classList.add('active');
    }
    renderLists();
  });
});

/* init on DOM ready */
document.addEventListener('DOMContentLoaded', async ()=>{
  await init();
  // initial render for active panel
  renderLists();
});
</script>

</body>
</html>